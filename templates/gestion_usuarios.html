<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Usuarios</title>
</head>
<body>
    <h1>Gestión de Usuarios</h1>
    <form method="POST">
        <input type="hidden" name="action" value="none" id="action">
        
        <label for="_id">ID:</label>
        <input type="text" id="_id" name="_id" placeholder="ID del Usuario" ><br>
        
        <label for="nombre_usuario">Nombre de Usuario:</label>
        <input type="text" id="nombre_usuario" name="nombre_usuario" placeholder="Nombre de Usuario">
        <input type="checkbox" name="update_nombre_usuario"><br>

        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" placeholder="Contraseña">
        <input type="checkbox" name="update_password"><br>

        <label for="tipo_usuario">Tipo de Usuario:</label>
        <select name="tipo_usuario" id="tipo_usuario">
            <option value="investigador">Investigador</option>
            <option value="colaborador">Colaborador</option>
        </select>
        <input type="checkbox" name="update_tipo_usuario"><br>

        <label for="grupo_indigena">Grupo Indígena:</label>
        <input type="text" id="grupo_indigena" name="grupo_indigena" placeholder="Grupo Indígena">
        <input type="checkbox" name="update_grupo_indigena"><br>

        <label for="idioma_hablado">Idioma Hablado:</label>
        <input type="text" id="idioma_hablado" name="idioma_hablado" placeholder="Idioma Hablado">
        <input type="checkbox" name="update_idioma_hablado"><br>

        <button type="button" onclick="submitForm('Agregar')">Agregar</button>
        <button type="button" onclick="submitForm('Actualizar')">Actualizar</button>
        <button type="button" onclick="submitForm('Eliminar')">Eliminar</button>
        <button type="button" onclick="submitForm('Consultar')">Consultar</button>
        <button type="button" onclick="submitForm('Ver Todo')">Ver Todo</button>
        <button type="button" onclick="window.location.href='{{ url_for('dashboard_investigador') }}'">Volver al Dashboard</button>
    </form>

    <!-- Additional buttons for new functionality -->
    <form method="POST" action="{{ url_for('consultar_receta') }}">
        <button type="submit">Consultar Receta</button>
    </form>

    <form method="POST" action="{{ url_for('consultar_ingredientes_usuario') }}">
        <input type="text" name="usuario" placeholder="Nombre de usuario para ingredientes">
        <button type="submit">Consultar Ingredientes</button>
    </form>

    <button onclick="window.location.href='{{ url_for('top_cinco') }}'">TOP 5 Usuarios</button>

    {% if modo == 'ver_todo' %}
    <h2>Usuarios en la Colección:</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre de Usuario</th>
                <th>Contraseña</th>
                <th>Tipo de Usuario</th>
                <th>Grupo Indígena</th>
                <th>Idioma Hablado</th>
            </tr>
        </thead>
        <tbody>
        {% for documento in documentos %}
            <tr>
                <td>{{ documento._id }}</td>
                <td>{{ documento.nombre_usuario }}</td>
                <td>{{ documento.password }}</td>
                <td>{{ documento.tipo_usuario }}</td>
                <td>{{ documento.grupo_indigena }}</td>
                <td>{{ documento.idioma_hablado }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No hay usuarios disponibles para mostrar.</p>
    {% endif %}


    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    {% endwith %}


    {% if ingredientes %}
    <h2>Ingredientes Modificados por el Usuario:</h2>
    <table  border="1">

        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre en Español</th>
                <th>Nombres en Lenguas Indígenas</th>
                <th>Ubicación de Producción</th>
                <th>Existencia Actual</th>
                <th>Consumo por Grupo</th>
            </tr>
        </thead>
        <tbody>
        {% for ingrediente in ingredientes %}
            <tr>
                <td>{{ ingrediente._id }}</td>
                <td>{{ ingrediente.name_spanish }}</td>
                <td>{{ ingrediente.names_indigenous_languages }}</td>
                <td>{{ ingrediente.production_location }}</td>
                <td>{{ ingrediente.exists_today }}</td>
                <td>{{ ingrediente.consumption_by_group }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% endif %}

    {% if top_usuarios %}
    <h2>Top 5 Usuarios con Más Cambios</h2>
    <ul>
        {% for usuario in top_usuarios %}
            <li>{{ usuario._id }}: {{ usuario.count }} cambios</li>
        {% endfor %}
    </ul>

    {% endif %}

    <script>
        function submitForm(action) {
            document.getElementById('action').value = action;
            document.forms[0].submit();
        }
    </script>
</body>
</html>





